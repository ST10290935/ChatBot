@{
    ViewData["Title"] = "Mental Health Support Chat";
}
<div class="chat-container">
    <h2>💬 Support Chat</h2>
    <div id="chatBox" class="chat-box"></div>
    <div class="input-group">
        <input type="text" id="userMessage" class="form-control" placeholder="Type your thoughts..." autocomplete="off" />
        <button id="sendBtn" class="btn btn-primary">Send</button>
    </div>
</div>

@section Scripts {
    <script>
        const box = document.getElementById("chatBox");
        const input = document.getElementById("userMessage");
        const btn = document.getElementById("sendBtn");

        btn.addEventListener("click", postMessage);
        input.addEventListener("keydown", e => { if (e.key === 'Enter') postMessage(); });

        async function postMessage() {
            const txt = input.value.trim();
            if (!txt) return;

            append("You", txt);
            input.value = "";

            try {
                const res = await fetch("/Chat/SendMessage", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ text: txt })
                });
                const data = await res.json();
                append(data.sender, data.text);
            } catch {
                append("AI", "Oops—something went wrong.");
            }
        }

        function append(sender, text) {
            const msg = document.createElement("div");
            msg.className = sender === "You" ? "msg user" : "msg ai";
            msg.innerHTML = `<strong>${sender}:</strong> ${text}`;
            box.appendChild(msg);
            box.scrollTop = box.scrollHeight;
        }
    </script>
}
